<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReadingOS - Your Learning Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --secondary-light: #f472b6;
            --accent: #10b981;
            --accent-light: #34d399;
            --warning: #f59e0b;
            --error: #ef4444;
            --dark: #0f172a;
            --dark-lighter: #1e293b;
            --dark-light: #334155;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #1a1a2e 50%, var(--dark-lighter) 100%);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        .bg-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Floating Elements */
        .floating-orb {
            position: fixed;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 8s ease-in-out infinite;
            z-index: -1;
        }

        .floating-orb:nth-child(1) {
            width: 100px;
            height: 100px;
            background: var(--primary);
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-orb:nth-child(2) {
            width: 60px;
            height: 60px;
            background: var(--secondary);
            top: 60%;
            right: 15%;
            animation-delay: 2s;
        }

        .floating-orb:nth-child(3) {
            width: 80px;
            height: 80px;
            background: var(--accent);
            bottom: 20%;
            left: 60%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(20px);
        }

        .login-card {
            background: var(--glass);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 48px;
            text-align: center;
            max-width: 480px;
            width: 90%;
            transform: scale(0.8);
            opacity: 0;
        }

        .login-card h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-light), var(--secondary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
        }

        .login-card p {
            color: var(--gray-light);
            font-size: 1.2rem;
            margin-bottom: 32px;
        }

        .input-group {
            position: relative;
            margin-bottom: 24px;
        }

        .input-group input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: var(--white);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.02);
        }

        .input-group input::placeholder {
            color: var(--gray);
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            border: none;
            border-radius: 16px;
            color: var(--white);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.3);
        }

        /* Main App */
        .app {
            display: none;
            min-height: 100vh;
            padding: 24px;
        }

        .app.active {
            display: block;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 40px;
            opacity: 0;
        }

        .header-left h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--white), var(--gray-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .header-left p {
            color: var(--gray-light);
            font-size: 1.1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-left: auto;
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 600;
            font-size: 1.2rem;
        }

        .user-details h3 {
            color: var(--white);
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .user-details p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .logout-btn {
            padding: 8px 16px;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            color: var(--error);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: scale(1.05);
        }

        /* Navigation */
        .nav-container {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            opacity: 0;
        }

        .nav-pills {
            display: flex;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 8px;
            gap: 4px;
        }

        .nav-pill {
            padding: 12px 24px;
            border-radius: 16px;
            background: transparent;
            border: none;
            color: var(--gray-light);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .nav-pill.active {
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            color: var(--white);
            transform: scale(1.05);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3);
        }

        .nav-pill:hover:not(.active) {
            color: var(--white);
            background: rgba(255, 255, 255, 0.1);
        }

        /* Content Sections */
        .content-section {
            display: none;
            opacity: 0;
        }

        .content-section.active {
            display: block;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            cursor: pointer;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.8;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            color: var(--gray-light);
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        /* Main Content Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 40px;
        }

        .panel {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            position: relative;
            overflow: hidden;
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .panel-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--white);
        }

        .panel-icon {
            font-size: 1.5rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            color: var(--gray-light);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-input, .form-select, .form-textarea {
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: var(--white);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.02);
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: var(--gray);
        }

        .form-select option {
            background: var(--dark-lighter);
            color: var(--white);
        }

        .btn-submit {
            padding: 16px 32px;
            background: linear-gradient(45deg, var(--accent), var(--accent-light));
            border: none;
            border-radius: 16px;
            color: var(--white);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 16px;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 32px rgba(16, 185, 129, 0.3);
        }

        .btn-quiz {
            background: linear-gradient(45deg, var(--secondary), var(--secondary-light));
        }

        .btn-quiz:hover {
            box-shadow: 0 16px 32px rgba(236, 72, 153, 0.3);
        }

        /* Session Lists */
        .session-list {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 24px;
        }

        .session-list::-webkit-scrollbar {
            width: 6px;
        }

        .session-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .session-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .session-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .session-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(8px);
            border-color: var(--primary);
        }

        .session-item.reading {
            border-left: 4px solid var(--accent);
        }

        .session-item.quiz {
            border-left: 4px solid var(--secondary);
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .session-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 4px;
        }

        .session-meta {
            display: flex;
            gap: 16px;
            color: var(--gray-light);
            font-size: 0.9rem;
        }

        .session-content {
            color: var(--gray-light);
            line-height: 1.6;
        }

        .quiz-score {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(45deg, var(--secondary), var(--secondary-light));
            color: var(--white);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .quiz-available {
            position: absolute;
            top: 16px;
            right: 16px;
            background: linear-gradient(45deg, var(--warning), #fbbf24);
            color: var(--white);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .delete-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.2);
            border: none;
            color: var(--error);
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .session-item:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: rgba(239, 68, 68, 0.4);
            transform: scale(1.1);
        }

        /* Quiz Interface */
        .quiz-interface {
            display: none;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            margin-top: 24px;
            text-align: center;
        }

        .quiz-interface.active {
            display: block;
        }

        .quiz-progress {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 32px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: var(--primary);
            transform: scale(1.2);
        }

        .progress-dot.completed {
            background: var(--accent);
        }

        .quiz-question {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 32px;
            line-height: 1.4;
        }

        .quiz-options {
            display: grid;
            gap: 16px;
            margin-bottom: 32px;
        }

        .quiz-option {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .quiz-option:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            transform: scale(1.02);
        }

        .quiz-option.selected {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.2);
        }

        .quiz-option.correct {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.2);
        }

        .quiz-option.incorrect {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.2);
        }

        .quiz-controls {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        .quiz-result {
            text-align: center;
            padding: 40px;
        }

        .quiz-result h3 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 16px;
        }

        .quiz-result .final-score {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 24px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 24px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 12px;
            color: var(--gray-light);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--glass);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 20px;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--white);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .user-info {
                margin-left: 0;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-pills {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .panel {
                padding: 24px;
            }
        }

        @media (max-width: 480px) {
            .app {
                padding: 16px;
            }
            
            .login-card {
                padding: 32px;
            }
            
            .header-left h1 {
                font-size: 2rem;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in-left {
            animation: slideInLeft 0.6s ease forwards;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .slide-in-right {
            animation: slideInRight 0.6s ease forwards;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation"></div>
    <div class="bg-overlay"></div>
    
    <!-- Floating Orbs -->
    <div class="floating-orb"></div>
    <div class="floating-orb"></div>
    <div class="floating-orb"></div>

    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h1>ReadingOS</h1>
            <p>Your personalized learning journey starts here</p>
            <form id="loginForm">
                <div class="input-group">
                    <input type="text" id="username" placeholder="Enter your name" required>
                </div>
                <button type="submit" class="btn-primary">Start Learning</button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div class="app" id="mainApp">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>ReadingOS</h1>
                <p>Transform knowledge into wisdom</p>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <h3 id="userName">User</h3>
                    <p id="userStats">Learning Explorer</p>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-container">
            <div class="nav-pills">
                <button class="nav-pill active" data-section="dashboard">
                    <span>üìä</span> Dashboard
                </button>
                <button class="nav-pill" data-section="reading">
                    <span>üìö</span> Reading
                </button>
                <button class="nav-pill" data-section="library">
                    <span>üìñ</span> My Library
                </button>
                <button class="nav-pill" data-section="analytics">
                    <span>üìà</span> Analytics
                </button>
            </div>
        </nav>

        <!-- Dashboard Section -->
        <section class="content-section active" id="dashboard">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-number" id="totalBooks">0</div>
                    <div class="stat-label">Books Read</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-number" id="totalHours">0</div>
                    <div class="stat-label">Hours Studied</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üß†</div>
                    <div class="stat-number" id="quizzesTaken">0</div>
                    <div class="stat-label">Quizzes Taken</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-number" id="averageScore">0</div>
                    <div class="stat-label">Average Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-number" id="currentStreak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-number" id="totalPoints">0</div>
                    <div class="stat-label">Learning Points</div>
                </div>
            </div>

            <div class="main-grid">
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-icon">üìà</span>
                        <h2>Recent Activity</h2>
                    </div>
                    <div class="session-list" id="recentActivity">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìä</div>
                            <h3>No activity yet</h3>
                            <p>Start reading to see your progress here</p>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-icon">üéØ</span>
                        <h2>Available Quizzes</h2>
                    </div>
                    <div class="session-list" id="availableQuizzes">
                        <div class="empty-state">
                            <div class="empty-state-icon">üß†</div>
                            <h3>No quizzes available</h3>
                            <p>Complete reading sessions to unlock quizzes</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reading Section -->
        <section class="content-section" id="reading">
            <div class="main-grid">
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-icon">‚ûï</span>
                        <h2>Add Reading Session</h2>
                    </div>
                    <form id="readingForm" class="form-grid">
                        <div class="form-group">
                            <label for="bookTitle">Book Title</label>
                            <input type="text" id="bookTitle" class="form-input" placeholder="Enter the book title..." required>
                        </div>
                        <div class="form-group">
                            <label for="author">Author</label>
                            <input type="text" id="author" class="form-input" placeholder="Author name..." required>
                        </div>
                        <div class="form-group">
                            <label for="category">Category</label>
                            <select id="category" class="form-select" required>
                                <option value="">Select a category...</option>
                                <option value="personal-growth">Personal Growth</option>
                                <option value="business">Business</option>
                                <option value="psychology">Psychology</option>
                                <option value="science">Science</option>
                                <option value="history">History</option>
                                <option value="fiction">Fiction</option>
                                <option value="biography">Biography</option>
                                <option value="philosophy">Philosophy</option>
                                <option value="technology">Technology</option>
                                <option value="health">Health & Wellness</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="chapterTitle">Chapter/Section</label>
                            <input type="text" id="chapterTitle" class="form-input" placeholder="e.g., Chapter 1: Introduction" required>
                        </div>
                        <div class="form-group">
                            <label for="duration">Reading Duration (minutes)</label>
                            <input type="number" id="duration" class="form-input" placeholder="30" min="1" max="480" required>
                        </div>
                        <div class="form-group">
                            <label for="keyInsights">Key Insights</label>
                            <textarea id="keyInsights" class="form-textarea" rows="4" placeholder="What were the main takeaways from this session?"></textarea>
                        </div>
                        <button type="submit" class="btn-submit">Add Reading Session</button>
                    </form>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-icon">üìñ</span>
                        <h2>Reading History</h2>
                    </div>
                    <div class="session-list" id="readingHistory">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìö</div>
                            <h3>No reading sessions yet</h3>
                            <p>Add your first reading session to get started</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Library Section -->
        <section class="content-section" id="library">
            <div class="main-grid">
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-icon">üìö</span>
                        <h2>My Books</h2>
                    </div>
                    <div class="session-list" id="bookLibrary">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìñ</div>
                            <h3>Your library is empty</h3>
                            <p>Books will appear here as you add reading sessions</p>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-icon">üèÜ</span>
                        <h2>Quiz Results</h2>
                    </div>
                    <div class="session-list" id="quizHistory">
                        <div class="empty-state">
                            <div class="empty-state-icon">üß†</div>
                            <h3>No quizzes completed</h3>
                            <p>Complete reading sessions and take quizzes to see results here</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section class="content-section" id="analytics">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-number" id="weeklyGoal">85</div>
                    <div class="stat-label">Weekly Goal %</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-number" id="bestStreak">0</div>
                    <div class="stat-label">Best Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-number" id="completionRate">0</div>
                    <div class="stat-label">Quiz Success Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-number" id="monthlyProgress">0</div>
                    <div class="stat-label">Monthly Growth</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">üìà</span>
                    <h2>Learning Insights</h2>
                </div>
                <div class="session-list" id="insights">
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <h3>Insights coming soon</h3>
                        <p>Complete more sessions to unlock personalized insights</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Quiz Interface Modal -->
    <div class="modal" id="quizModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeQuiz()">&times;</button>
            <div class="quiz-interface">
                <div class="quiz-progress" id="quizProgress">
                    <!-- Progress dots will be generated here -->
                </div>
                <div class="quiz-question" id="quizQuestion">
                    Question will appear here
                </div>
                <div class="quiz-options" id="quizOptions">
                    <!-- Options will be generated here -->
                </div>
                <div class="quiz-controls">
                    <button class="btn-submit" id="submitAnswer" disabled>Submit Answer</button>
                    <button class="btn-submit" id="nextQuestion" style="display: none;">Next Question</button>
                </div>
                <div class="quiz-result" id="quizResult" style="display: none;">
                    <!-- Results will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('successModal')">&times;</button>
            <div style="text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 20px;">üéâ</div>
                <h2 style="color: var(--white); margin-bottom: 16px;" id="successTitle">Success!</h2>
                <p style="color: var(--gray-light); line-height: 1.6;" id="successMessage">
                    Great job! Keep up the excellent work.
                </p>
            </div>
        </div>
    </div>

    <script>
        // User session management
        let currentUser = null;
        let userSessions = {};

        // Quiz questions database organized by book and chapter
        const quizDatabase = {
            'atomic-habits': {
                'chapter-1': [
                    {
                        question: "According to James Clear, what is the key to building good habits?",
                        options: [
                            "Motivation and willpower",
                            "Making them obvious, attractive, easy, and satisfying", 
                            "Setting big goals",
                            "Perfect planning"
                        ],
                        correct: 1,
                        explanation: "The four laws of behavior change make habits stick by working with human psychology."
                    },
                    {
                        question: "What does the '1% better every day' principle teach us?",
                        options: [
                            "Small improvements compound over time",
                            "You need to make big changes",
                            "Progress should be linear",
                            "Only perfection matters"
                        ],
                        correct: 0,
                        explanation: "Small, consistent improvements compound into remarkable results over time."
                    }
                ],
                'chapter-2': [
                    {
                        question: "What is a 'habit stack' according to Atomic Habits?",
                        options: [
                            "Doing many habits at once",
                            "Linking a new habit to an existing habit",
                            "Stacking books on habits",
                            "Breaking bad habits"
                        ],
                        correct: 1,
                        explanation: "Habit stacking uses existing habits as triggers for new ones."
                    }
                ]
            },
            'psychology-of-money': {
                'chapter-1': [
                    {
                        question: "What is Morgan Housel's main thesis about money psychology?",
                        options: [
                            "Money is purely mathematical",
                            "Everyone thinks about money the same way",
                            "Personal finance is more personal than finance",
                            "Rich people are always rational"
                        ],
                        correct: 2,
                        explanation: "Financial decisions are driven by personal experiences and emotions, not just logic."
                    }
                ]
            }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            animateLogin();
        });

        function initializeApp() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('readingos_user');
            if (savedUser) {
                currentUser = savedUser;
                loadUserData();
                showMainApp();
            }
        }

        function animateLogin() {
            gsap.to('.login-card', {
                duration: 1,
                scale: 1,
                opacity: 1,
                ease: "back.out(1.7)"
            });
        }

        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Reading form
            document.getElementById('readingForm').addEventListener('submit', handleReadingSession);
            
            // Navigation
            document.querySelectorAll('.nav-pill').forEach(pill => {
                pill.addEventListener('click', () => switchSection(pill.dataset.section));
            });

            // Quiz controls
            document.getElementById('submitAnswer').addEventListener('click', submitQuizAnswer);
            document.getElementById('nextQuestion').addEventListener('click', nextQuizQuestion);
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            
            if (username) {
                currentUser = username;
                localStorage.setItem('readingos_user', username);
                loadUserData();
                showMainApp();
            }
        }

        function showMainApp() {
            gsap.to('.login-screen', {
                duration: 0.5,
                opacity: 0,
                scale: 0.9,
                onComplete: () => {
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainApp').classList.add('active');
                    animateMainApp();
                }
            });
        }

        function animateMainApp() {
            // Update user info
            document.getElementById('userName').textContent = currentUser;
            document.getElementById('userAvatar').textContent = currentUser.charAt(0).toUpperCase();
            
            // Animate sections
            gsap.timeline()
                .to('.header', { duration: 0.6, opacity: 1, y: 0, ease: "power2.out" })
                .to('.nav-container', { duration: 0.6, opacity: 1, y: 0, ease: "power2.out" }, "-=0.3")
                .to('.stat-card', { 
                    duration: 0.8, 
                    opacity: 1, 
                    y: 0, 
                    stagger: 0.1, 
                    ease: "power2.out" 
                }, "-=0.4")
                .to('.panel', { 
                    duration: 0.8, 
                    opacity: 1, 
                    x: 0, 
                    stagger: 0.1, 
                    ease: "power2.out" 
                }, "-=0.6");

            updateDashboard();
        }

        function loadUserData() {
            const savedData = localStorage.getItem(`readingos_data_${currentUser}`);
            if (savedData) {
                userSessions[currentUser] = JSON.parse(savedData);
            } else {
                userSessions[currentUser] = {
                    readingSessions: [],
                    quizSessions: [],
                    stats: {
                        totalBooks: 0,
                        totalHours: 0,
                        quizzesTaken: 0,
                        averageScore: 0,
                        currentStreak: 0,
                        totalPoints: 0
                    }
                };
            }
        }

        function saveUserData() {
            if (currentUser && userSessions[currentUser]) {
                localStorage.setItem(`readingos_data_${currentUser}`, JSON.stringify(userSessions[currentUser]));
            }
        }

        function getCurrentUserData() {
            return userSessions[currentUser] || { readingSessions: [], quizSessions: [], stats: {} };
        }

        function switchSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');

            // Animate transition
            gsap.fromTo(`#${sectionName}`, 
                { opacity: 0, y: 20 },
                { opacity: 1, y: 0, duration: 0.5, ease: "power2.out" }
            );

            // Update section-specific content
            if (sectionName === 'library') {
                updateLibrary();
            } else if (sectionName === 'analytics') {
                updateAnalytics();
            }
        }

        function handleReadingSession(e) {
            e.preventDefault();
            
            const formData = {
                bookTitle: document.getElementById('bookTitle').value.trim(),
                author: document.getElementById('author').value.trim(),
                category: document.getElementById('category').value,
                chapterTitle: document.getElementById('chapterTitle').value.trim(),
                duration: parseInt(document.getElementById('duration').value),
                keyInsights: document.getElementById('keyInsights').value.trim(),
                date: new Date(),
                id: Date.now()
            };

            // Add to user data
            const userData = getCurrentUserData();
            userData.readingSessions.unshift(formData);
            
            // Update stats
            updateUserStats();
            
            // Save data
            saveUserData();
            
            // Update UI
            updateDashboard();
            updateReadingHistory();
            checkForAvailableQuizzes();
            
            // Show success message
            showSuccessModal('üìö Reading Session Added!', 'Great job! Your reading session has been recorded. Keep up the excellent work!');
            
            // Reset form
            e.target.reset();
        }

        function updateUserStats() {
            const userData = getCurrentUserData();
            const sessions = userData.readingSessions;
            const quizzes = userData.quizSessions;
            
            // Calculate unique books
            const uniqueBooks = new Set(sessions.map(s => s.bookTitle.toLowerCase()));
            userData.stats.totalBooks = uniqueBooks.size;
            
            // Calculate total hours
            userData.stats.totalHours = Math.round(sessions.reduce((sum, s) => sum + s.duration, 0) / 60 * 10) / 10;
            
            // Calculate quiz stats
            userData.stats.quizzesTaken = quizzes.length;
            if (quizzes.length > 0) {
                userData.stats.averageScore = Math.round(quizzes.reduce((sum, q) => sum + q.score, 0) / quizzes.length);
            }
            
            // Calculate streak
            userData.stats.currentStreak = calculateStreak(sessions);
            
            // Calculate points (reading time * 10 + quiz scores)
            userData.stats.totalPoints = Math.round(userData.stats.totalHours * 10) + quizzes.reduce((sum, q) => sum + q.score, 0);
        }

        function calculateStreak(sessions) {
            if (sessions.length === 0) return 0;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let streak = 0;
            let currentDate = new Date(today);
            
            for (let i = 0; i < 30; i++) {
                const hasSessionToday = sessions.some(session => {
                    const sessionDate = new Date(session.date);
                    sessionDate.setHours(0, 0, 0, 0);
                    return sessionDate.getTime() === currentDate.getTime();
                });
                
                if (hasSessionToday) {
                    streak++;
                } else if (streak > 0) {
                    break;
                }
                
                currentDate.setDate(currentDate.getDate() - 1);
            }
            
            return streak;
        }

        function updateDashboard() {
            const userData = getCurrentUserData();
            const stats = userData.stats;
            
            // Animate stats updates
            animateStatUpdate('totalBooks', stats.totalBooks || 0);
            animateStatUpdate('totalHours', stats.totalHours || 0);
            animateStatUpdate('quizzesTaken', stats.quizzesTaken || 0);
            animateStatUpdate('averageScore', stats.averageScore || 0);
            animateStatUpdate('currentStreak', stats.currentStreak || 0);
            animateStatUpdate('totalPoints', stats.totalPoints || 0);
            
            // Update recent activity
            updateRecentActivity();
            updateAvailableQuizzes();
        }

        function animateStatUpdate(elementId, value) {
            const element = document.getElementById(elementId);
            gsap.to(element, {
                duration: 1,
                innerText: value,
                snap: { innerText: elementId === 'totalHours' ? 0.1 : 1 },
                ease: "power2.out"
            });
        }

        function updateRecentActivity() {
            const userData = getCurrentUserData();
            const allActivity = [
                ...userData.readingSessions.map(s => ({...s, type: 'reading'})),
                ...userData.quizSessions.map(s => ({...s, type: 'quiz'}))
            ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            
            const container = document.getElementById('recentActivity');
            
            if (allActivity.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <h3>No activity yet</h3>
                        <p>Start reading to see your progress here</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = allActivity.map(activity => {
                if (activity.type === 'reading') {
                    return `
                        <div class="session-item reading">
                            <div class="session-header">
                                <div>
                                    <div class="session-title">${activity.bookTitle}</div>
                                    <div class="session-meta">
                                        <span>üìñ ${activity.chapterTitle}</span>
                                        <span>‚è±Ô∏è ${activity.duration}min</span>
                                        <span>üìÖ ${formatDate(activity.date)}</span>
                                    </div>
                                </div>
                                ${hasQuizAvailable(activity) ? '<div class="quiz-available">Quiz Ready!</div>' : ''}
                            </div>
                            <div class="session-content">${activity.keyInsights || 'No notes added'}</div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="session-item quiz">
                            <div class="session-header">
                                <div>
                                    <div class="session-title">${activity.bookTitle}</div>
                                    <div class="session-meta">
                                        <span>üß† ${activity.chapterTitle}</span>
                                        <span class="quiz-score">${activity.score}%</span>
                                        <span>üìÖ ${formatDate(activity.date)}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="session-content">Quiz completed with ${activity.correctAnswers}/${activity.totalQuestions} correct answers</div>
                        </div>
                    `;
                }
            }).join('');
        }

        function updateAvailableQuizzes() {
            const userData = getCurrentUserData();
            const availableQuizzes = userData.readingSessions.filter(session => 
                hasQuizAvailable(session) && !hasQuizBeenTaken(session)
            );
            
            const container = document.getElementById('availableQuizzes');
            
            if (availableQuizzes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üß†</div>
                        <h3>No quizzes available</h3>
                        <p>Complete reading sessions to unlock quizzes</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = availableQuizzes.map(session => `
                <div class="session-item reading" onclick="startQuiz('${session.id}')">
                    <div class="session-header">
                        <div>
                            <div class="session-title">${session.bookTitle}</div>
                            <div class="session-meta">
                                <span>üìñ ${session.chapterTitle}</span>
                                <span>üß† Quiz Available</span>
                            </div>
                        </div>
                        <div class="quiz-available">Take Quiz</div>
                    </div>
                    <div class="session-content">Test your knowledge of this chapter</div>
                </div>
            `).join('');
        }

        function hasQuizAvailable(session) {
            const bookKey = session.bookTitle.toLowerCase().replace(/[^a-z0-9]/g, '-');
            const chapterKey = session.chapterTitle.toLowerCase().replace(/[^a-z0-9]/g, '-');
            return quizDatabase[bookKey] && quizDatabase[bookKey][chapterKey];
        }

        function hasQuizBeenTaken(session) {
            const userData = getCurrentUserData();
            return userData.quizSessions.some(quiz => 
                quiz.bookTitle === session.bookTitle && 
                quiz.chapterTitle === session.chapterTitle
            );
        }

        function checkForAvailableQuizzes() {
            updateAvailableQuizzes();
        }

        function updateReadingHistory() {
            const userData = getCurrentUserData();
            const sessions = userData.readingSessions;
            const container = document.getElementById('readingHistory');
            
            if (sessions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <h3>No reading sessions yet</h3>
                        <p>Add your first reading session to get started</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = sessions.map(session => `
                <div class="session-item reading">
                    <button class="delete-btn" onclick="deleteSession('${session.id}', 'reading')">&times;</button>
                    <div class="session-header">
                        <div>
                            <div class="session-title">${session.bookTitle}</div>
                            <div class="session-meta">
                                <span>üë§ ${session.author}</span>
                                <span>üìñ ${session.chapterTitle}</span>
                                <span>‚è±Ô∏è ${session.duration}min</span>
                                <span>üìÖ ${formatDate(session.date)}</span>
                            </div>
                        </div>
                        ${hasQuizAvailable(session) && !hasQuizBeenTaken(session) ? 
                            `<div class="quiz-available" onclick="startQuiz('${session.id}')">Take Quiz</div>` : 
                            hasQuizBeenTaken(session) ? '<div style="color: var(--accent); font-size: 0.8rem;">‚úì Quiz Completed</div>' : ''
                        }
                    </div>
                    <div class="session-content">${session.keyInsights || 'No notes added'}</div>
                </div>
            `).join('');
        }

        function updateLibrary() {
            const userData = getCurrentUserData();
            const books = {};
            
            // Group sessions by book
            userData.readingSessions.forEach(session => {
                if (!books[session.bookTitle]) {
                    books[session.bookTitle] = {
                        title: session.bookTitle,
                        author: session.author,
                        category: session.category,
                        sessions: [],
                        totalTime: 0
                    };
                }
                books[session.bookTitle].sessions.push(session);
                books[session.bookTitle].totalTime += session.duration;
            });
            
            const bookArray = Object.values(books);
            const container = document.getElementById('bookLibrary');
            
            if (bookArray.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìñ</div>
                        <h3>Your library is empty</h3>
                        <p>Books will appear here as you add reading sessions</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = bookArray.map(book => `
                <div class="session-item reading">
                    <div class="session-header">
                        <div>
                            <div class="session-title">${book.title}</div>
                            <div class="session-meta">
                                <span>üë§ ${book.author}</span>
                                <span>üìö ${book.category}</span>
                                <span>üìä ${book.sessions.length} sessions</span>
                                <span>‚è±Ô∏è ${Math.round(book.totalTime / 60 * 10) / 10}h total</span>
                            </div>
                        </div>
                    </div>
                    <div class="session-content">Latest: ${book.sessions[0].chapterTitle}</div>
                </div>
            `).join('');
            
            // Update quiz history
            const quizContainer = document.getElementById('quizHistory');
            if (userData.quizSessions.length === 0) {
                quizContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üß†</div>
                        <h3>No quizzes completed</h3>
                        <p>Complete reading sessions and take quizzes to see results here</p>
                    </div>
                `;
            } else {
                quizContainer.innerHTML = userData.quizSessions.map(quiz => `
                    <div class="session-item quiz">
                        <button class="delete-btn" onclick="deleteSession('${quiz.id}', 'quiz')">&times;</button>
                        <div class="session-header">
                            <div>
                                <div class="session-title">${quiz.bookTitle}</div>
                                <div class="session-meta">
                                    <span>üß† ${quiz.chapterTitle}</span>
                                    <span class="quiz-score">${quiz.score}%</span>
                                    <span>üìÖ ${formatDate(quiz.date)}</span>
                                </div>
                            </div>
                        </div>
                        <div class="session-content">
                            Scored ${quiz.correctAnswers}/${quiz.totalQuestions} correct answers
                            ${quiz.score >= 80 ? 'üèÜ Excellent!' : quiz.score >= 60 ? 'üëç Good job!' : 'üí™ Keep practicing!'}
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateAnalytics() {
            const userData = getCurrentUserData();
            
            // Calculate analytics
            const weeklyGoal = calculateWeeklyGoal(userData.readingSessions);
            const bestStreak = calculateBestStreak(userData.readingSessions);
            const completionRate = calculateQuizCompletionRate(userData);
            const monthlyProgress = calculateMonthlyProgress(userData.readingSessions);
            
            animateStatUpdate('weeklyGoal', weeklyGoal);
            animateStatUpdate('bestStreak', bestStreak);
            animateStatUpdate('completionRate', completionRate);
            animateStatUpdate('monthlyProgress', monthlyProgress);
        }

        function calculateWeeklyGoal(sessions) {
            const now = new Date();
            const weekStart = new Date(now.getFullYear(), now.getMonth(), now.getDate() - now.getDay());
            const weekSessions = sessions.filter(s => new Date(s.date) >= weekStart);
            const weeklyMinutes = weekSessions.reduce((sum, s) => sum + s.duration, 0);
            const goalMinutes = 300; // 5 hours
            return Math.min(100, Math.round((weeklyMinutes / goalMinutes) * 100));
        }

        function calculateBestStreak(sessions) {
            if (sessions.length === 0) return 0;
            
            let maxStreak = 0;
            let currentStreak = 1;
            
            const sortedSessions = sessions
                .map(s => new Date(s.date))
                .sort((a, b) => a - b)
                .map(d => d.toDateString());
            
            const uniqueDates = [...new Set(sortedSessions)];
            
            for (let i = 1; i < uniqueDates.length; i++) {
                const prevDate = new Date(uniqueDates[i - 1]);
                const currDate = new Date(uniqueDates[i]);
                const diffDays = (currDate - prevDate) / (1000 * 60 * 60 * 24);
                
                if (diffDays === 1) {
                    currentStreak++;
                } else {
                    maxStreak = Math.max(maxStreak, currentStreak);
                    currentStreak = 1;
                }
            }
            
            return Math.max(maxStreak, currentStreak);
        }

        function calculateQuizCompletionRate(userData) {
            if (userData.quizSessions.length === 0) return 0;
            const passingQuizzes = userData.quizSessions.filter(q => q.score >= 70).length;
            return Math.round((passingQuizzes / userData.quizSessions.length) * 100);
        }

        function calculateMonthlyProgress(sessions) {
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            const monthSessions = sessions.filter(s => new Date(s.date) >= monthStart);
            return monthSessions.length;
        }

        // Quiz functionality
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let quizAnswers = [];

        function startQuiz(sessionId) {
            const userData = getCurrentUserData();
            const session = userData.readingSessions.find(s => s.id == sessionId);
            
            if (!session) return;
            
            const bookKey = session.bookTitle.toLowerCase().replace(/[^a-z0-9]/g, '-');
            const chapterKey = session.chapterTitle.toLowerCase().replace(/[^a-z0-9]/g, '-');
            const questions = quizDatabase[bookKey]?.[chapterKey];
            
            if (!questions) {
                showSuccessModal('ü§î Quiz Not Available', 'Quiz questions for this chapter are not available yet. Check back later!');
                return;
            }
            
            currentQuiz = {
                sessionId,
                bookTitle: session.bookTitle,
                chapterTitle: session.chapterTitle,
                questions: [...questions],
                startTime: new Date()
            };
            
            currentQuestionIndex = 0;
            selectedAnswer = null;
            quizAnswers = [];
            
            document.getElementById('quizModal').classList.add('active');
            setupQuizInterface();
            displayQuestion();
        }

        function setupQuizInterface() {
            const progressContainer = document.getElementById('quizProgress');
            progressContainer.innerHTML = currentQuiz.questions.map((_, index) => 
                `<div class="progress-dot ${index === 0 ? 'active' : ''}"></div>`
            ).join('');
        }

        function displayQuestion() {
            const question = currentQuiz.questions[currentQuestionIndex];
            
            document.getElementById('quizQuestion').textContent = 
                `Question ${currentQuestionIndex + 1} of ${currentQuiz.questions.length}: ${question.question}`;
            
            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = question.options.map((option, index) => `
                <div class="quiz-option" onclick="selectAnswer(${index}, this)">
                    ${option}
                </div>
            `).join('');
            
            document.getElementById('submitAnswer').disabled = true;
            document.getElementById('nextQuestion').style.display = 'none';
            document.getElementById('quizResult').style.display = 'none';
            selectedAnswer = null;
            
            // Update progress dots
            document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index < currentQuestionIndex) {
                    dot.classList.add('completed');
                } else if (index === currentQuestionIndex) {
                    dot.classList.add('active');
                }
            });
        }

        function selectAnswer(answerIndex, element) {
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            element.classList.add('selected');
            selectedAnswer = answerIndex;
            document.getElementById('submitAnswer').disabled = false;
        }

        function submitQuizAnswer() {
            if (selectedAnswer === null) return;
            
            const question = currentQuiz.questions[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correct;
            
            quizAnswers.push({
                questionIndex: currentQuestionIndex,
                selectedAnswer,
                correct: question.correct,
                isCorrect,
                explanation: question.explanation
            });
            
            // Show correct/incorrect styling
            document.querySelectorAll('.quiz-option').forEach((opt, index) => {
                if (index === question.correct) {
                    opt.classList.add('correct');
                } else if (index === selectedAnswer && !isCorrect) {
                    opt.classList.add('incorrect');
                }
            });
            
            document.getElementById('submitAnswer').disabled = true;
            
            if (currentQuestionIndex < currentQuiz.questions.length - 1) {
                document.getElementById('nextQuestion').style.display = 'inline-block';
            } else {
                setTimeout(() => finishQuiz(), 2000);
            }
        }

        function nextQuizQuestion() {
            currentQuestionIndex++;
            displayQuestion();
        }

        function finishQuiz() {
            const correctAnswers = quizAnswers.filter(a => a.isCorrect).length;
            const totalQuestions = currentQuiz.questions.length;
            const score = Math.round((correctAnswers / totalQuestions) * 100);
            
            // Save quiz result
            const userData = getCurrentUserData();
            const quizResult = {
                id: Date.now(),
                bookTitle: currentQuiz.bookTitle,
                chapterTitle: currentQuiz.chapterTitle,
                score,
                correctAnswers,
                totalQuestions,
                duration: Math.round((new Date() - currentQuiz.startTime) / 1000 / 60),
                date: new Date(),
                answers: quizAnswers
            };
            
            userData.quizSessions.unshift(quizResult);
            updateUserStats();
            saveUserData();
            
            // Show results
            const resultContainer = document.getElementById('quizResult');
            let performance = '';
            if (score >= 90) performance = 'üèÜ Outstanding!';
            else if (score >= 80) performance = 'üåü Excellent!';
            else if (score >= 70) performance = 'üëç Good job!';
            else if (score >= 60) performance = 'üìà Keep improving!';
            else performance = 'üí™ Practice makes perfect!';
            
            resultContainer.innerHTML = `
                <h3>Quiz Complete!</h3>
                <div class="final-score">${score}%</div>
                <p>${performance}</p>
                <p>You got ${correctAnswers} out of ${totalQuestions} questions correct!</p>
                <br>
                <div style="text-align: left;">
                    ${quizAnswers.map((answer, index) => `
                        <div style="margin-bottom: 16px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <strong>Q${index + 1}:</strong> ${answer.isCorrect ? '‚úÖ' : '‚ùå'}<br>
                            <small style="color: var(--gray-light);">${answer.explanation}</small>
                        </div>
                    `).join('')}
                </div>
                <button class="btn-submit" onclick="closeQuiz()">Finish Quiz</button>
            `;
            resultContainer.style.display = 'block';
            
            document.getElementById('quizQuestion').style.display = 'none';
            document.getElementById('quizOptions').style.display = 'none';
            document.querySelector('.quiz-controls').style.display = 'none';
            
            // Update dashboard
            updateDashboard();
        }

        function closeQuiz() {
            document.getElementById('quizModal').classList.remove('active');
            document.getElementById('quizQuestion').style.display = 'block';
            document.getElementById('quizOptions').style.display = 'block';
            document.querySelector('.quiz-controls').style.display = 'flex';
            document.getElementById('quizResult').style.display = 'none';
            
            currentQuiz = null;
            updateDashboard();
            
            if (document.querySelector('.content-section.active').id === 'reading') {
                updateReadingHistory();
            }
        }

        function deleteSession(sessionId, type) {
            if (!confirm(`Are you sure you want to delete this ${type} session?`)) return;
            
            const userData = getCurrentUserData();
            
            if (type === 'reading') {
                userData.readingSessions = userData.readingSessions.filter(s => s.id != sessionId);
                updateReadingHistory();
            } else {
                userData.quizSessions = userData.quizSessions.filter(s => s.id != sessionId);
            }
            
            updateUserStats();
            saveUserData();
            updateDashboard();
            
            if (document.querySelector('.content-section.active').id === 'library') {
                updateLibrary();
            }
        }

        function formatDate(date) {
            const now = new Date();
            const sessionDate = new Date(date);
            const diffTime = now - sessionDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                return 'Today';
            } else if (diffDays === 1) {
                return 'Yesterday';
            } else if (diffDays < 7) {
                return `${diffDays} days ago`;
            } else {
                return sessionDate.toLocaleDateString();
            }
        }

        function showSuccessModal(title, message) {
            document.getElementById('successTitle').textContent = title;
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').classList.add('active');
            
            setTimeout(() => {
                closeModal('successModal');
            }, 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                localStorage.removeItem('readingos_user');
                
                document.getElementById('mainApp').classList.remove('active');
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('username').value = '';
                
                gsap.to('.login-card', {
                    duration: 0.6,
                    scale: 1,
                    opacity: 1,
                    ease: "back.out(1.7)"
                });
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape to close modals
            if (e.key === 'Escape') {
                if (document.getElementById('quizModal').classList.contains('active')) {
                    if (confirm('Are you sure you want to exit the quiz? Your progress will be lost.')) {
                        closeQuiz();
                    }
                } else {
                    closeModal('successModal');
                }
            }
            
            // Enter to submit in quiz
            if (e.key === 'Enter' && document.getElementById('quizModal').classList.contains('active')) {
                if (!document.getElementById('submitAnswer').disabled) {
                    submitQuizAnswer();
                } else if (document.getElementById('nextQuestion').style.display !== 'none') {
                    nextQuizQuestion();
                }
            }
            
            // Number keys for navigation
            if (e.altKey) {
                const sections = ['dashboard', 'reading', 'library', 'analytics'];
                const num = parseInt(e.key);
                if (num >= 1 && num <= sections.length) {
                    e.preventDefault();
                    switchSection(sections[num - 1]);
                }
            }
        });

        // Add sample data function for testing
        window.addSampleData = function() {
            if (!currentUser) {
                alert('Please login first');
                return;
            }
            
            const userData = getCurrentUserData();
            
            // Sample reading sessions
            const sampleReadingSessions = [
                {
                    id: Date.now() - 1000,
                    bookTitle: 'Atomic Habits',
                    author: 'James Clear',
                    category: 'personal-growth',
                    chapterTitle: 'Chapter 1: The Surprising Power of Atomic Habits',
                    duration: 45,
                    keyInsights: 'Small changes compound over time. The 1% rule - getting 1% better every day leads to remarkable results.',
                    date: new Date(Date.now() - 1000 * 60 * 60 * 24 * 1) // 1 day ago
                },
                {
                    id: Date.now() - 2000,
                    bookTitle: 'Atomic Habits',
                    author: 'James Clear',
                    category: 'personal-growth',
                    chapterTitle: 'Chapter 2: How Your Habits Shape Your Identity',
                    duration: 50,
                    keyInsights: 'Every action is a vote for the type of person you want to become. Identity-based habits are more powerful than outcome-based habits.',
                    date: new Date(Date.now() - 1000 * 60 * 60 * 24 * 2) // 2 days ago
                },
                {
                    id: Date.now() - 3000,
                    bookTitle: 'The Psychology of Money',
                    author: 'Morgan Housel',
                    category: 'business',
                    chapterTitle: 'Chapter 1: No One\'s Crazy',
                    duration: 35,
                    keyInsights: 'Personal finance is more personal than finance. Everyone has different experiences that shape their relationship with money.',
                    date: new Date(Date.now() - 1000 * 60 * 60 * 24 * 3) // 3 days ago
                }
            ];
            
            userData.readingSessions.unshift(...sampleReadingSessions);
            updateUserStats();
            saveUserData();
            updateDashboard();
            updateReadingHistory();
            checkForAvailableQuizzes();
            
            showSuccessModal('üìö Sample Data Added!', 'Sample reading sessions have been added to help you explore the features.');
        };

        // Export data function
        window.exportUserData = function() {
            if (!currentUser) {
                alert('Please login first');
                return;
            }
            
            const userData = getCurrentUserData();
            const dataStr = JSON.stringify(userData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `readingos-${currentUser}-${new Date().toISOString().slice(0,10)}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        };
    </script>
</body>
</html>